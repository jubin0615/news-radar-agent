-- Default keyword seed data (최초 빈 테이블일 때만 삽입 — 사용자가 삭제한 키워드가 재생성되지 않음)
MERGE INTO KEYWORD (NAME, STATUS, CREATED_AT) KEY(NAME)
SELECT 'ai', 'ACTIVE', CURRENT_TIMESTAMP FROM DUAL
WHERE (SELECT COUNT(*) FROM KEYWORD) = 0;

MERGE INTO KEYWORD (NAME, STATUS, CREATED_AT) KEY(NAME)
SELECT 'llm', 'ACTIVE', CURRENT_TIMESTAMP FROM DUAL
WHERE (SELECT COUNT(*) FROM KEYWORD) = 0;

MERGE INTO KEYWORD (NAME, STATUS, CREATED_AT) KEY(NAME)
SELECT 'open ai', 'ACTIVE', CURRENT_TIMESTAMP FROM DUAL
WHERE (SELECT COUNT(*) FROM KEYWORD) = 0;

MERGE INTO KEYWORD (NAME, STATUS, CREATED_AT) KEY(NAME)
SELECT 'google', 'ACTIVE', CURRENT_TIMESTAMP FROM DUAL
WHERE (SELECT COUNT(*) FROM KEYWORD) = 0;

MERGE INTO KEYWORD (NAME, STATUS, CREATED_AT) KEY(NAME)
SELECT '사이버보안', 'ACTIVE', CURRENT_TIMESTAMP FROM DUAL
WHERE (SELECT COUNT(*) FROM KEYWORD) = 0;

-- News → CrawledUrl 초기 마이그레이션 (기존 URL 히스토리를 경량 테이블로 복사)
-- MERGE INTO ... KEY(URL)로 멱등성 보장 — 매 서버 기동 시 재실행해도 중복 삽입 없음
MERGE INTO CRAWLED_URL (URL, CREATED_AT) KEY(URL)
SELECT N.URL, COALESCE(N.COLLECTED_AT, CURRENT_TIMESTAMP)
FROM NEWS N
WHERE N.URL IS NOT NULL;
